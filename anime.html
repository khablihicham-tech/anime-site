<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تفاصيل الأنمي</title>
<style>
body { font-family: Arial, sans-serif; background:#121212; color:#fff; margin:0; padding:0; text-align:center; }
header { background:#ff3b3f; padding:20px; font-size:26px; font-weight:bold; }
button {
    margin:5px; padding:10px 15px; border-radius:5px;
    border:none; cursor:pointer; background:#ff3b3f; color:#fff;
    transition:0.3s;
}
button:hover { opacity:0.8; }

/* قائمة الحلقات على شكل شبكة */
#episodeList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
    justify-items: center;
    margin:20px auto;
    max-width: 900px;
}

/* زر الحلقة */
#episodeList button {
    width: 100%;
    padding:10px;
    box-sizing: border-box;
}

/* نافذة الفيديو Modal */
.modal {
    display:none; position:fixed; z-index:1000;
    left:0; top:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); justify-content:center; align-items:center;
}
.modal-content {
    position:relative; background:#000; padding:10px; border-radius:10px;
    max-width:900px; width:90%;
}
.close-btn {
    position:absolute; top:5px; right:10px;
    background:#ff3b3f; border:none; color:#fff; font-size:18px;
    padding:5px 10px; cursor:pointer; border-radius:5px;
}
iframe { width:100%; height:500px; border:none; border-radius:10px; }

/* صورة الأنمي أكبر */
img.anime-img {
    width:95%;          /* زادنا العرض قليلًا */
    max-width:600px;    /* زادنا الحد الأقصى */
    border-radius:10px; 
    margin-top:20px; 
    box-shadow:0 0 20px #ff3b3f; /* ظل أكبر قليلًا */
}
</style>
</head>
<body>

<header>تطبيق الأنمي</header>

<!-- زر الرجوع -->
<button onclick="goHome()">⬅ الرجوع للرئيسية</button>

<div id="animeContainer">
    <p>جارٍ تحميل الأنمي...</p>
</div>

<!-- نافذة الفيديو Modal -->
<div id="videoModal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal()">✖</button>
        <iframe id="videoFrame" src="" allowfullscreen></iframe>
    </div>
</div>

<script>
// زر الرجوع
function goHome(){ window.location.href="index.html"; }

// قراءة اسم الأنمي من الرابط
function getAnimeTitle(){
    const params = new URLSearchParams(window.location.search);
    return params.get('title');
}

// جلب الأنميات من localStorage
let animes = JSON.parse(localStorage.getItem("animes")) || [];

// عرض الأنمي
function showAnime(){
    const title = getAnimeTitle();
    const anime = animes.find(a => a.title === title);
    const container = document.getElementById("animeContainer");

    if(!anime){
        container.innerHTML = "<p>❌ لم يتم العثور على هذا الأنمي</p>";
        return;
    }

    container.innerHTML = `
        <img src="${anime.image}" alt="${anime.title}" class="anime-img">
        <h2>${anime.title}</h2>
        <h3>${anime.season}</h3>
        <div id="episodeList"></div>
        <p>اختر حلقة لتشغيل الفيديو</p>
    `;

    const episodeList = document.getElementById("episodeList");

    anime.episodes.forEach(ep=>{
        const btn = document.createElement("button");
        btn.textContent = ep.title;
        btn.addEventListener("click", ()=> openModal(ep.video));
        episodeList.appendChild(btn);
    });
}

// فتح Modal أو فتح الرابط في نافذة جديدة إذا غير قابل للعرض
function openModal(videoUrl){
    let canEmbed = false;

    if(videoUrl.includes("youtube.com/watch")){
        const urlObj = new URL(videoUrl);
        const id = urlObj.searchParams.get("v");
        if(id){
            videoUrl = "https://www.youtube.com/embed/" + id;
            canEmbed = true;
        }
    }
    else if(videoUrl.includes("youtube.com/embed")){
        canEmbed = true;
    }
    else if(videoUrl.endsWith(".mp4")){
        canEmbed = true;
    }

    if(canEmbed){
        document.getElementById("videoFrame").src = videoUrl;
        document.getElementById("videoModal").style.display = "flex";
    } else {
        window.open(videoUrl, "_blank");
    }
}

// إغلاق Modal وإيقاف الفيديو
function closeModal(){
    document.getElementById("videoFrame").src = "";
    document.getElementById("videoModal").style.display = "none";
}

// تنفيذ العرض عند تحميل الصفحة
showAnime();
</script>

</body>
</html>
