<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù†Ù…ÙŠ</title>
<style>
body { font-family: Arial, sans-serif; background:#121212; color:#fff; margin:0; }
header { background:#ff3b3f; padding:15px; text-align:center; font-size:24px; font-weight:bold; }
.container { max-width:900px; margin:auto; padding:15px; }
form { background:#1c1c1c; padding:15px; border-radius:8px; margin-bottom:20px; }
input { width:100%; margin:6px 0; padding:10px; border-radius:5px; border:none; font-size:15px; }
button { padding:8px 15px; border:none; border-radius:5px; cursor:pointer; font-size:15px; }
.btn-add { background:#28a745; color:white; }
.btn-delete { background:#dc3545; color:white; }
.btn-edit { background:#ffc107; color:black; }
.anime-card { background:#1e1e1e; margin:10px 0; padding:10px; border-radius:8px; display:flex; }
.anime-card img { width:120px; height:160px; object-fit:cover; border-radius:8px; margin-right:15px; }
.category-box { display:flex; flex-wrap:wrap; gap:8px; margin:10px 0; }
.category-box span { background:#2a2a2a; padding:6px 14px; border-radius:20px; cursor:pointer; }
.category-box span.active { background:#ff3b3f; }
.episodeRow input { margin-bottom:0; }
</style>
</head>
<body>

<header>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù†Ù…ÙŠ</header>
<div class="container">

<form id="episodeForm">
<input type="text" id="animeName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ù†Ù…ÙŠ">

<label>ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ</label>
<div id="categoryBox" class="category-box">
  <span>Ø£ÙƒØ´Ù†</span><span>Ù…ØºØ§Ù…Ø±Ø©</span><span>Ø±ÙŠØ§Ø¶ÙŠ</span>
  <span>ØºÙ…ÙˆØ¶</span><span>ÙƒÙˆÙ…ÙŠØ¯ÙŠ</span><span>Ø¯Ø±Ø§Ù…Ø§</span>
  <span>Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ</span><span>Ø®ÙŠØ§Ù„ Ø¹Ù„Ù…ÙŠ</span><span>ÙØ§Ù†ØªØ§Ø²ÙŠØ§</span>
</div>

<label>Ù†ÙˆØ¹ Ø§Ù„Ø£Ù†Ù…ÙŠ</label><br>
<input type="radio" name="animeType" value="Ù…Ø³Ù„Ø³Ù„" checked> Ù…Ø³Ù„Ø³Ù„
<input type="radio" name="animeType" value="ÙÙŠÙ„Ù…"> ÙÙŠÙ„Ù…
<input type="radio" name="animeType" value="Ù…Ù„Ø®Ù‘Øµ"> Ù…Ù„Ø®Ù‘Øµ
<br><br>

<input type="text" id="season" placeholder="Ø§Ù„Ù…ÙˆØ³Ù…">

<label>Ø§Ù„Ø­Ù„Ù‚Ø§Øª</label>
<div id="episodesContainer"></div>
<button type="button" onclick="addEpisodeRow()" class="btn-add">+ Ø­Ù„Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>

<input type="text" id="animeImage" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø£Ù†Ù…ÙŠ">
<button type="submit" class="btn-add">Ø­ÙØ¸</button>
</form>

<!-- Ø¨Ø­Ø« + ÙÙ„ØªØ±Ø© -->
<div style="display:flex;gap:10px;margin:15px 0;">
  <input type="text" id="searchInput" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…ÙŠ..." style="flex:2; padding:10px; border-radius:5px; border:none;">
  
  <select id="filterType" style="flex:1; padding:10px; border-radius:5px; border:none;">
    <option value="">Ø§Ù„ÙƒÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</option>
    <option value="Ù…Ø³Ù„Ø³Ù„">Ù…Ø³Ù„Ø³Ù„</option>
    <option value="ÙÙŠÙ„Ù…">ÙÙŠÙ„Ù…</option>
    <option value="Ù…Ù„Ø®Ù‘Øµ">Ù…Ù„Ø®Ù‘Øµ</option>
  </select>

  <select id="filterCategory" style="flex:1; padding:10px; border-radius:5px; border:none;">
    <option value="">Ø§Ù„ÙƒÙ„ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</option>
    <option value="Ø£ÙƒØ´Ù†">Ø£ÙƒØ´Ù†</option>
    <option value="Ù…ØºØ§Ù…Ø±Ø©">Ù…ØºØ§Ù…Ø±Ø©</option>
    <option value="Ø±ÙŠØ§Ø¶ÙŠ">Ø±ÙŠØ§Ø¶ÙŠ</option>
    <option value="ØºÙ…ÙˆØ¶">ØºÙ…ÙˆØ¶</option>
    <option value="ÙƒÙˆÙ…ÙŠØ¯ÙŠ">ÙƒÙˆÙ…ÙŠØ¯ÙŠ</option>
    <option value="Ø¯Ø±Ø§Ù…Ø§">Ø¯Ø±Ø§Ù…Ø§</option>
    <option value="Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ">Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ</option>
    <option value="Ø®ÙŠØ§Ù„ Ø¹Ù„Ù…ÙŠ">Ø®ÙŠØ§Ù„ Ø¹Ù„Ù…ÙŠ</option>
    <option value="ÙØ§Ù†ØªØ§Ø²ÙŠØ§">ÙØ§Ù†ØªØ§Ø²ÙŠØ§</option>
  </select>
</div>

<div id="animeList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
 apiKey: "AIzaSyBYEyu6TxSv1qSLCRvr0YCdaVcewhxAmQY",
 authDomain: "appp-1234.firebaseapp.com",
 databaseURL: "https://appp-1234-default-rtdb.firebaseio.com",
 projectId: "appp-1234",
 storageBucket: "appp-1234.firebasestorage.app",
 messagingSenderId: "666495369108",
 appId: "1:666495369108:web:aabf062e066cea6c3b9981"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const animesRef = db.ref("animes");

let animes = [];
let editIndex = null;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
animesRef.on("value", snapshot=>{
 const data = snapshot.val();
 if(data){ animes = data; }
 renderAnimeList();
});

function saveData(){ animesRef.set(animes); }

// ===== Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª =====
document.querySelectorAll("#categoryBox span").forEach(span=>{
 span.addEventListener("click",()=> span.classList.toggle("active"));
});

// ===== Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø­Ù„Ù‚Ø© =====
function addEpisodeRow(num="", link=""){
 const container = document.getElementById("episodesContainer");
 const row = document.createElement("div");
 row.className="episodeRow";
 row.style.display="flex";
 row.style.gap="10px";
 row.style.marginBottom="5px";
 row.innerHTML=`
   <input type="text" class="episodeNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­Ù„Ù‚Ø©" style="flex:1;" value="${num}">
   <input type="text" class="episodeLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ù„Ù‚Ø©" style="flex:3;" value="${link}">
   <button type="button" onclick="this.parentElement.remove()" style="background:#dc3545;color:white;border:none;border-radius:5px;">âœ–</button>
 `;
 container.appendChild(row);
}

// Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© â†’ Ø³Ø·Ø± Ø­Ù„Ù‚Ø© ÙˆØ§Ø­Ø¯
addEpisodeRow();

// Ø¬Ù…Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø§Øª
function collectEpisodes(){
 const episodes=[];
 document.querySelectorAll(".episodeRow").forEach(row=>{
   const num = row.querySelector(".episodeNumber").value.trim();
   const link = row.querySelector(".episodeLink").value.trim();
   if(num && link){
     episodes.push({title:"Ø§Ù„Ø­Ù„Ù‚Ø© "+num, video:link});
   }
 });
 return episodes;
}

// ===== Ø­ÙØ¸ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠ =====
episodeForm.addEventListener("submit", e=>{
 e.preventDefault();
 const title = animeName.value.trim();
 const seasonVal = season.value.trim();
 const imgVal = animeImage.value.trim();
 const selectedCategories = Array.from(document.querySelectorAll("#categoryBox span.active")).map(e=>e.textContent);
 const selectedType = document.querySelector('input[name="animeType"]:checked').value;
 const episodes = collectEpisodes();

 if(title=="" || seasonVal=="" || selectedCategories.length==0 || episodes.length==0){
   alert("Ø¹Ù…Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
   return;
 }

 if(editIndex !== null){
   animes[editIndex] = {title, season:seasonVal, image:imgVal, category:selectedCategories, type:selectedType, episodes};
   editIndex = null;
 } else {
   animes.unshift({title, season:seasonVal, image:imgVal, category:selectedCategories, type:selectedType, episodes});
 }

 saveData();
 renderAnimeList();
 episodeForm.reset();
 document.getElementById("episodesContainer").innerHTML="";
 addEpisodeRow();
 document.querySelectorAll("#categoryBox span").forEach(s=>s.classList.remove("active"));
});

// ===== Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª Ù…Ø¹ Ø§Ù„Ø¨Ø­Ø« + ÙÙ„ØªØ±Ø© =====
function renderAnimeList(){
 const list=document.getElementById("animeList");
 list.innerHTML="";
 let filtered=[...animes];

 // ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…
 const searchValue=document.getElementById("searchInput").value.toLowerCase();
 if(searchValue) filtered = filtered.filter(a => a.title.toLowerCase().includes(searchValue));

 // ÙÙ„ØªØ±Ø© Ø§Ù„Ù†ÙˆØ¹
 const filterType = document.getElementById("filterType").value;
 if(filterType) filtered = filtered.filter(a => a.type === filterType);

 // ÙÙ„ØªØ±Ø© Ø§Ù„ØªØµÙ†ÙŠÙ
 const filterCategory = document.getElementById("filterCategory").value;
 if(filterCategory) filtered = filtered.filter(a => a.category.includes(filterCategory));

 filtered.forEach(anime=>{
   const realIndex = animes.indexOf(anime);
   const div=document.createElement("div");
   div.className="anime-card";
   div.innerHTML=`
     <img src="${anime.image}">
     <div style="flex:1">
       <h3>${anime.title} - ${anime.season} (${anime.type})</h3>
       <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù„Ù‚Ø§Øª: ${anime.episodes.length}</p>
       <button class="btn-edit" onclick="editAnime(${realIndex})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
       <button class="btn-delete" onclick="deleteAnime(${realIndex})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
     </div>
   `;
   list.appendChild(div);
 });
}

// ===== Ø­Ø°Ù Ø£Ù†Ù…ÙŠ =====
function deleteAnime(index){
 if(confirm("Ù…ØªØ£ÙƒØ¯ ØªØ­Ø°Ù Ø§Ù„Ø£Ù†Ù…ÙŠØŸ")){
   animes.splice(index,1);
   saveData();
   renderAnimeList();
 }
}

// ===== ØªØ¹Ø¯ÙŠÙ„ Ø£Ù†Ù…ÙŠ + Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù„Ù‚Ø§Øª =====
function editAnime(index){
 const anime = animes[index];
 editIndex = index;
 animeName.value = anime.title;
 season.value = anime.season;
 animeImage.value = anime.image;
 document.querySelectorAll('input[name="animeType"]').forEach(r=>{ r.checked = (r.value==anime.type); });
 document.querySelectorAll("#categoryBox span").forEach(span=>{
   span.classList.remove("active");
   if(anime.category.includes(span.textContent)) span.classList.add("active");
 });
 const container = document.getElementById("episodesContainer");
 container.innerHTML="";
 anime.episodes.forEach(ep=>{
   const num = ep.title.replace("Ø§Ù„Ø­Ù„Ù‚Ø© ","");
   addEpisodeRow(num, ep.video);
 });
 window.scrollTo({top:0,behavior:"smooth"});
}

// ===== Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø© =====
document.getElementById("searchInput").addEventListener("input", renderAnimeList);
document.getElementById("filterType").addEventListener("change", renderAnimeList);
document.getElementById("filterCategory").addEventListener("change", renderAnimeList);

// Ø¹Ø±Ø¶ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
renderAnimeList();
</script>
</body>
</html>
